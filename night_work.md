night_work.md

[상세 지시사항: Phase 0 - 홈 화면(Dashboard) UI/UX 심층 구현]

`app/dashboard/page.tsx`는 단순한 페이지가 아니라, 사용자의 역할(Role)에 따라 완전히 다른 UX를 제공하는 **'이중 인터페이스(Dual Interface)'**로 구현해.

---

### 🅰️ 사장님 화면 (Admin View) - '통합 결재 관제탑'
**목표:** 한눈에 자금 흐름과 업무 병목을 파악하고, 마우스 클릭 몇 번으로 모든 '승인(Approval)'을 처리한다.

**1. 상단 KPI 섹션 (4-Grid Cards)**
   - **디자인:** Shadcn Card 컴포넌트 사용, 중요 숫자는 크게, 전일 대비 증감률 표시.
   - **카드 1 [매출 현황]:** 금일 포인트 충전 총액 (단위: 원). 클릭 시 `revenue` 통계 페이지 이동.
   - **카드 2 [자금 결재]:** 현재 승인 대기 중인 입금 건수 (Red Badge로 강조).
   - **카드 3 [업무 결재]:** 직원이 처리 완료했으나 아직 최종 마감되지 않은 티켓 건수.
   - **카드 4 [접수 물량]:** 오늘 들어온 총 편지 개수 / 처리 완료율(%).

**2. 중앙 메인 섹션 (The Approval Center)**
   - 화면 중앙을 **2:1 비율** 혹은 **좌우 분할**로 나누어 두 개의 리스트를 배치해.
   
   **[좌측: 자금 승인 리스트 (Finance Queue)]**
   - **데이터:** `point_requests` 테이블의 `status = 'matched' OR 'pending'`.
   - **UI:** 테이블 형태. [입금자명 | 신청자ID | 금액 | 매칭여부 | 승인버튼 | 거절버튼]
   - **기능:** '매칭됨(Matched)' 상태인 건은 [승인] 버튼이 활성화되어 클릭 한 번으로 포인트 지급 완료.
   
   **[우측: 업무 승인 리스트 (Operation Queue)]**
   - **데이터:** `tasks` 테이블의 `status = 'processed'`. (직원이 1차 처리를 끝낸 건)
   - **UI:** 카드 리스트 형태. [티켓 종류(도서/물품) | 담당직원 | 처리요약 | 검토버튼]
   - **기능:** 클릭 시 모달(Modal)이 뜨면서 직원이 입력한 내용과 원본 사진을 비교하고 [최종 마감(Finalize)] 처리.

**3. 하단 섹션 (Stats & Logs)**
   - **교도소별 현황:** 가로 막대 그래프로 어떤 교도소 물량이 많은지 시각화.
   - **실시간 로그:** 시스템 내 주요 활동(입금, 처리, 오류 등)을 타임라인으로 표시.

---

### 🅱️ 직원 화면 (Staff Workstation) - '고속 입력 패널'
**목표:** 페이지 이동(Navigation)을 0으로 줄이고, 마우스와 키보드만으로 하루 500건을 처리할 수 있는 생산성 도구.

**1. 레이아웃 구조 (3-Column Fixed View)**
   - 브라우저 스크롤을 없애고 `h-screen` (화면 꽉 채움)으로 고정해.
   
   **[Column 1: 작업 대기열 (Queue) - 15%]**
   - 내게 배당된 티켓(`status='assigned'`) 리스트.
   - 각 항목은 `priority`(긴급) 여부와 `type`(도서/구매) 아이콘을 표시.
   - 클릭 시 해당 티켓이 활성화됨.

   **[Column 2: 뷰어 (Viewer) - 45%]**
   - 편지 이미지를 보여주는 캔버스 영역.
   - **기능:** 휠 스크롤로 줌인/줌아웃(Zoom), 드래그로 이동(Pan), `R`키로 회전(Rotate).
   - 이미지가 작아서 글씨가 안 보이는 일이 절대 없도록 구현.

   **[Column 3: 입력 폼 (Action Panel) - 40%]**
   - **Tabs:** [도서 신청], [구매/발주], [경기 결과], [기타 문의] 탭으로 구성.
   - **Smart Input:** 도서 입력 시 ISBN이나 제목을 치면 DB에서 자동완성 추천.
   - **Footer Action:** 화면 맨 아래에 아주 큰 **[저장 후 다음 (Save & Next)]** 버튼 배치. (단축키: `Ctrl + Enter` 바인딩).

**2. 보안 및 제한 (Security)**
   - 직원은 상단 헤더에 '매출', '포인트' 관련 메뉴가 아예 보이지 않아야 함.
   - 본인이 처리한 건수와 "오늘의 목표 달성률" 같은 동기 부여 지표만 작게 표시.

   현재 폴더에 있는 'project_spec.md' 파일과 '.cursorrules' 파일을 읽고 내용을 완벽히 파악해.
이 설계도를 바탕으로 **전문적인 상용 ERP 수준의 UI/UX**를 갖춘 시스템을 구축해.

나는 자러 갈 거니까, 중간에 멈추지 말고 아래 단계들을 순서대로 모두 구현하고, 에러가 나면 스스로 수정(Self-Correction)해서 끝까지 완료해.

[🚨 핵심 원칙: 기존 코드 보존 및 점진적 개선]
- **공격적인 리셋 금지:** 기존에 작성된 파일이나 폴더 구조를 무조건 삭제하지 마.
- **점진적 개선 (Refactoring):** 현재 작동하는 기능은 최대한 유지하고, 새로운 설계도와 맞지 않는 부분만 수정하거나 추가해.

[작업 지시 사항: 기능 구현]

1. **Phase 0: 롤 기반 대시보드 (Role-Based Dashboard)**
   - `app/dashboard/page.tsx`에서 로그인한 유저의 `role` (admin/staff)에 따라 완전히 다른 UI를 렌더링해.
   
   **🅰️ 사장님 화면 (Admin View) - '통합 결재 관제탑'**
   - **상단 KPI:** 금일 매출(Points), 입금 대기(Red Badge), 업무 결재 대기, 총 접수량.
   - **중앙 메인(통합 결재):** 화면을 분할하여 두 개의 리스트 배치.
     1. **[자금 승인]:** `point_requests` 중 'matched'/'pending' 건. (입금자명/금액 -> 승인 버튼)
     2. **[업무 승인]:** `tasks` 중 'processed' 건. (직원 처리 내역 -> 마감/반려 버튼)
   - **하단:** 교도소별 접수 현황 차트 및 실시간 시스템 로그.

   **🅱️ 직원 화면 (Staff Workstation) - '고속 입력 패널'**
   - **레이아웃:** 페이지 이동 없는 **'3-Column Split View'** (높이 100vh 고정, 스크롤 없음).
     - **좌측 (15%):** '할 일 목록(Queue)' - 배당된 티켓 리스트.
     - **중앙 (45%):** '이미지 뷰어' - 줌/이동/회전 가능한 캔버스.
     - **우측 (40%):** '입력 폼' - [도서/경기/물품] 탭 기반 입력창.
   - **워크플로우:** 하단에 큰 **[저장 후 다음(Save & Next)]** 버튼 배치 (단축키 지원).
   - **보안:** 매출 및 포인트 관련 메뉴 접근 원천 차단.

2. **Phase 8: 뱅킹 및 입출금 자동화**
   - **DB:** `bank_transactions` 테이블 생성.
   - **Webhook:** `app/api/webhooks/bank` 구현. 외부(SMS앱) POST 요청 시 `depositor_name`과 `amount`로 충전 신청건 자동 매칭.
   - **로직:** 매칭 성공 시 사장님 대시보드 [자금 승인] 란에 즉시 노출. 내부 이체는 매출 집계 제외.

3. **기타 필수 구현 (Phases 1~7)**
   - **모바일:** `/mailroom` 페이지는 `<input capture="environment">`로 카메라 즉시 연동.
   - **물류:** 사전등록 완료 건을 교도소별로 묶어 A4 송장 출력 모달 구현.
   - **마감:** `gpt-4o-mini`를 연동하여 사장님 승인 시 고객용 답장 자동 생성 및 저장.

[디자인 가이드]
- **Shadcn UI & Tailwind CSS:** 모든 컴포넌트는 Shadcn UI를 사용하여 'Clean & Dense'한 상용 서비스 스타일로 통일.
- **피드백:** 작업 성공/실패 시 반드시 Toast 팝업을 띄워 사용자에게 알려줘.
- **다크 모드:** 기본적으로 눈이 편한 모던한 색감(Slate/Gray 톤)을 사용해.

[제약 사항]
- 질문하지 말고 판단해서 진행해 (Auto-approve mode).
- 내가 깰 때까지 멈추지 말고 끝까지 구현해.

OCR 업로드 - 검수 = 우편실로 합체, 우편실을 메인으로 해서.

재무관리 - 계좌관리 : 재무관리 로 합체,
일일 답변 - 일괄 출력 : 합체.

스포츠 관리 -> 배팅업무 로 변경
물류 -> 발주업무로 변경

직원관리 -> 설정으로 넣어두기.

권한별로 표시되는 탭이 다른데 이를 색깔로 구별하기.

[추가 지시사항: Phase 0 & 8 - 롤 기반 대시보드 및 뱅킹 자동화]

1. **롤 기반 대시보드 (Role-Based Dashboard):**
   - `app/dashboard/page.tsx`에 접속하면, 로그인한 사용자의 `role` (admin/staff)을 체크해서 서로 다른 화면을 보여줘.

   **[🅰️ 사장님 화면 (Admin View)] - '관리와 통제'**
   - **KPI 카드:** 금일 매출(Points), 입금 대기 건수, 총 접수량, 처리 지연 건수. - **④ 금일 예상 매출:** 오늘 생성된 `tasks`의 총 포인트 합계.
   - **차트:** 주간 매출 추이 및 교도소별 접수 통계.
   - **입금 승인:** `point_logs`의 'pending' 건을 바로 승인/거절할 수 있는 위젯.
   - **모든 메뉴 접근 가능:** `banking`, `closing`, `users` 등 모든 관리 메뉴 노출.

   **[🅱️ 직원 화면 (Staff View)] - '실무와 작업'**
   - **KPI 카드:** "나의 할 일(My Tasks)", "오늘 처리한 건수", "반려된 건수". (**매출/포인트 총액은 절대 보여주지 마**)
   - **퀵 액션:** [우편물 사진 찍기], [송장 출력], [내 작업 리스트] 버튼을 크게 배치.
   - **제한:** `banking`(입출금), `points`(포인트관리) 메뉴는 사이드바에서 아예 숨겨줘.

2. **뱅킹 및 입출금 자동화 (Phase 8):**
   - `app/api/webhooks/bank`를 구현해. 외부(문자 앱)에서 입금 알림이 오면 `depositor_name`과 `amount`를 기준으로 충전 신청 내역(`point_requests`)을 찾아 자동으로 매칭해.
   - 매칭된 건은 '승인 대기(matched)' 상태로 바꾸고, 사장님 대시보드에 알림을 띄워.
   - 출금 내역이나 내부 이체는 `bank_transactions` 테이블에 기록만 남기고, 대시보드 '자금 흐름' 탭에서 볼 수 있게 해.

3. **로직 연결:**
   - Supabase RLS(Row Level Security)를 설정해서, 직원이 API를 직접 호출해도 남의 급여나 회사 매출 데이터를 조회할 수 없게 막아줘.

   - 자주 쓰는 메뉴로 바로 가는 큰 버튼들을 배치해. (아이콘 포함)
   - [우편물 사진 업로드], [입금 확인하러 가기], [발주 필요 물품 보기], [A4 송장 출력].

   **하단 우측: 실시간 활동 로그 (Live Feed):**
   - 최근 5개의 활동(입금 신청, 우편 접수, 배당 완료 등)을 시간순으로 리스트업해서 보여줘.
   - 예: "홍길동님이 50,000원 충전을 요청했습니다. (10분 전)"

